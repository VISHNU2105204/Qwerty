<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="Screenshot 2025-10-22 140606.png" />
  <title>Reset Password - Truth Detector AI</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Reset password page specific styles - enhanced styles in styles.css */
    body {
      animation: pageFadeIn 0.6s ease-out;
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      min-height: 100vh;
    }
    
    .center {
      text-align: center;
    }
    
    .password-wrapper .auth-input {
      padding-right: 3.5rem;
    }
    
    .error-message {
      background: linear-gradient(135deg, #fef2f2, #fee2e2);
      color: #dc2626;
      padding: 1rem;
      border-radius: 12px;
      margin-bottom: 1rem;
      border: 2px solid #fecaca;
      display: none;
      animation: shake 0.5s ease;
      box-shadow: 0 4px 12px rgba(220, 38, 38, 0.15);
      transition: all 0.3s ease;
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    
    .success-message {
      background: linear-gradient(135deg, #f0fdf4, #dcfce7);
      color: #16a34a;
      padding: 1rem;
      border-radius: 12px;
      margin-bottom: 1rem;
      border: 2px solid #bbf7d0;
      display: none;
      animation: slideInUp 0.5s ease;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);
      transition: all 0.3s ease;
    }
    
    .error-message:hover,
    .success-message:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    }
  </style>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const urlParams = new URLSearchParams(window.location.search);
      const token = urlParams.get('token');

      if (!token) {
        showError('Invalid reset link. Please request a new password reset.');
        return;
      }

      // Password toggle functionality
      const passwordInput = document.getElementById('newPassword');
      const confirmPasswordInput = document.getElementById('confirmPassword');
      const passwordToggle = document.getElementById('passwordToggle');
      const confirmPasswordToggle = document.getElementById('confirmPasswordToggle');
      const toggleIcon = document.getElementById('toggleIcon');
      const confirmToggleIcon = document.getElementById('confirmToggleIcon');

      passwordToggle.addEventListener('click', () => {
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);

        if (type === 'text') {
          toggleIcon.textContent = 'üôà';
          toggleIcon.setAttribute('aria-label', 'Hide password');
        } else {
          toggleIcon.textContent = 'üëÅÔ∏è';
          toggleIcon.setAttribute('aria-label', 'Show password');
        }
      });

      confirmPasswordToggle.addEventListener('click', () => {
        const type = confirmPasswordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        confirmPasswordInput.setAttribute('type', type);

        if (type === 'text') {
          confirmToggleIcon.textContent = 'üôà';
          confirmToggleIcon.setAttribute('aria-label', 'Hide password');
        } else {
          confirmToggleIcon.textContent = 'üëÅÔ∏è';
          confirmToggleIcon.setAttribute('aria-label', 'Show password');
        }
      });

      const form = document.getElementById('resetForm');
      const submitBtn = document.querySelector('.auth-btn');
      const originalBtnText = submitBtn.textContent;

      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const newPassword = document.getElementById('newPassword').value.trim();
        const confirmPassword = document.getElementById('confirmPassword').value.trim();

        if (!newPassword || !confirmPassword) {
          showError('Please fill in all fields.');
          return;
        }

        if (newPassword !== confirmPassword) {
          showError('Passwords do not match.');
          return;
        }

        if (newPassword.length < 6) {
          showError('Password must be at least 6 characters long.');
          return;
        }

        // Show loading state
        submitBtn.textContent = 'Resetting password...';
        submitBtn.disabled = true;

        try {
          const response = await fetch('/api/reset-password', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              token: token,
              newPassword: newPassword
            })
          });

          const data = await response.json();

          if (response.ok) {
            showSuccess(data.message);
            // Redirect to login after success
            setTimeout(() => {
              window.location.href = 'login.html';
            }, 2000);
          } else {
            showError(data.error || 'Password reset failed.');
          }
        } catch (error) {
          console.error('Reset password error:', error);
          showError('Password reset failed. Please try again.');
        } finally {
          // Reset button state
          submitBtn.textContent = originalBtnText;
          submitBtn.disabled = false;
        }
      });

      function showError(message) {
        const errorDiv = document.getElementById('errorMessage');
        errorDiv.textContent = message;
        errorDiv.style.display = 'block';
        document.getElementById('successMessage').style.display = 'none';
      }

      function showSuccess(message) {
        const successDiv = document.getElementById('successMessage');
        successDiv.textContent = message;
        successDiv.style.display = 'block';
        document.getElementById('errorMessage').style.display = 'none';
      }
    });
  </script>
  <script src="navigation-interceptor.js"></script>
</head>

<body>
  <div class="auth-hero">
    <a href="index.html" style="text-decoration: none; color: inherit;">
      <h1>Reset your password</h1>
    </a>
    <p>Enter your new password below</p>
  </div>
  <div class="auth-wrapper">
    <div class="auth-card">
      <a class="nav-home" href="login.html">‚Üê Back to Login</a>
      <p class="auth-sub">Choose a strong password for your account</p>

      <div id="errorMessage" class="error-message"></div>
      <div id="successMessage" class="success-message"></div>

      <form id="resetForm">
        <div class="auth-field">
          <label class="auth-label" for="newPassword">New Password</label>
          <div class="password-wrapper">
            <input class="auth-input" id="newPassword" name="newPassword" type="password" placeholder="Enter new password" required />
            <button type="button" class="password-toggle" id="passwordToggle" aria-label="Toggle password visibility">
              <span id="toggleIcon">üëÅÔ∏è</span>
            </button>
          </div>
        </div>
        <div class="auth-field">
          <label class="auth-label" for="confirmPassword">Confirm New Password</label>
          <div class="password-wrapper">
            <input class="auth-input" id="confirmPassword" name="confirmPassword" type="password" placeholder="Confirm new password" required />
            <button type="button" class="password-toggle" id="confirmPasswordToggle" aria-label="Toggle password visibility">
              <span id="confirmToggleIcon">üëÅÔ∏è</span>
            </button>
          </div>
        </div>
        <button class="auth-btn" type="submit">Reset Password</button>
      </form>

      <p class="auth-footer center">Remembered it? <a class="auth-link" href="login.html">Login</a></p>
    </div>
  </div>
</body>

</html>
